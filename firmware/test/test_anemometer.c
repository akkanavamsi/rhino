#include "unity.h"
#include "anemometer.h"
#include "statistics_buffers.h"
#define test_1_min_input_num_pts 60
void test_1_min_input_vector_wind_dir_avg(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windSpeed_vector_avg, windDir_vector_avg;
    getWindVectorMean(&windSpeed_vector_avg,
                      &windDir_vector_avg);
    TEST_ASSERT_EQUAL_FLOAT(24.869240324929873, windDir_vector_avg);
}

void test_1_min_input_vector_wind_speed_avg(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windSpeed_vector_avg, windDir_vector_avg;
    getWindVectorMean(&windSpeed_vector_avg,
                      &windDir_vector_avg);
    TEST_ASSERT_EQUAL_FLOAT(0.4042848124913664, windSpeed_vector_avg);
}

void test_1_min_input_wind_dir_sin_avg(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windDir_stdDev, windDir_sin_avg, windDir_cos_avg;
    getWindVectorStdDev(&windDir_stdDev,
                        &windDir_sin_avg,
                        &windDir_cos_avg);
    TEST_ASSERT_EQUAL_FLOAT(0.3135627442707202, windDir_sin_avg);
}

void test_1_min_input_wind_dir_cos_avg(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windDir_stdDev, windDir_sin_avg, windDir_cos_avg;
    getWindVectorStdDev(&windDir_stdDev,
                        &windDir_sin_avg,
                        &windDir_cos_avg);
    TEST_ASSERT_EQUAL_FLOAT(0.589977435612048, windDir_cos_avg);
}

void test_1_min_input_vector_wind_dir_stdev(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windDir_stdDev, windDir_sin_avg, windDir_cos_avg;
    getWindVectorStdDev(&windDir_stdDev,
                        &windDir_sin_avg,
                        &windDir_cos_avg);
    TEST_ASSERT_EQUAL_FLOAT(46.6791526217996, windDir_stdDev);
}

void test_1_min_input_scalar_wind_speed_stdev(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windSpeed_avg, windSpeed_stdev;
    getWindSpeedScalarAvgStdDev(&windSpeed_avg,
                                &windSpeed_stdev);
    TEST_ASSERT_EQUAL_FLOAT(0.2629480303532747, windSpeed_stdev);
}

void test_1_min_input_scalar_wind_speed_avg(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Polar[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSamplePolar(wdir_Polar[i], windSpeedData[i]);
    }
    float windSpeed_avg, windSpeed_stdev;
    getWindSpeedScalarAvgStdDev(&windSpeed_avg,
                                &windSpeed_stdev);
    TEST_ASSERT_EQUAL_FLOAT(0.545, windSpeed_avg);
}

void test_convert_cardinal_to_polar(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float wdir_Cardinal[test_1_min_input_num_pts] = {256.700012, 272.799988, 252.5, 256.200012, 250.699997, 255.399994, 246.399994, 250.699997, 246.399994, 236.899994,
                                                     223.800003, 219.100006, 216.5, 229.600006, 210.100006, 200.5, 210.100006, 201.5, 253.5, 255.399994, 270.0, 264.799988,
                                                     274.0, 289.200012, 317.0, 336.200012, 349.200012, 324.200012, 301.299988, 285.299988, 287.700012, 271.700012, 265.899994,
                                                     255.100006, 261.700012, 195.899994, 116.699997, 142.399994, 107.400002, 157.399994, 171.399994, 164.800003, 167.0, 176.5,
                                                     197.199997, 189.300003, 194.800003, 184.800003, 184.0, 178.199997, 222.300003, 264.5, 277.399994, 286.600006, 275.700012,
                                                     286.100006, 276.5, 272.799988, 274.0, 265.700012};
    float wdir_Polar_Truth[test_1_min_input_num_pts] = {13.299987999999985, 357.200012, 17.5, 13.799987999999985, 19.300003000000004, 14.600006000000008, 23.600006000000008,
                                                  19.300003000000004, 23.600006000000008, 33.10000600000001, 46.199996999999996, 50.89999399999999, 53.5, 40.39999399999999,
                                                  59.89999399999999, 69.5, 59.89999399999999, 68.5, 16.5, 14.600006000000008, 0.0, 5.200012000000015, 356.0, 340.799988, 313.0,
                                                  293.799988, 280.799988, 305.799988, 328.700012, 344.700012, 342.299988, 358.299988, 4.100006000000008, 14.899993999999992, 8.299987999999985,
                                                  74.10000600000001, 153.300003, 127.60000600000001, 162.599998, 112.60000600000001, 98.60000600000001, 105.199997, 103.0, 93.5, 72.800003,
                                                  80.699997, 75.199997, 85.199997, 86.0, 91.800003, 47.699996999999996, 5.5, 352.600006, 343.399994, 354.299988, 343.899994, 353.5,
                                                  357.200012, 356.0, 4.299987999999985};
    float wdir_Polar[test_1_min_input_num_pts];
    for (int i = 0; i < num_pts; i++)
    {
        wdir_Polar[i]=convert_cardinal_to_polar(wdir_Cardinal[i]);
    }
    TEST_ASSERT_EQUAL_FLOAT_ARRAY(wdir_Polar_Truth,wdir_Polar,test_1_min_input_num_pts);
}


void test_1_min_input_vector_wind_dir_avg_cardinal(void)
{
    const int32_t num_pts = test_1_min_input_num_pts;
    float windSpeedData[test_1_min_input_num_pts] = {0.8, 0.8, 1.0, 1.0, 0.9, 0.9, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.4, 0.6, 0.6, 0.4, 0.1, 0.1, 0.2, 0.3, 0.5, 0.5,
                                                     0.4, 0.3, 0.3, 0.4, 0.3, 0.3, 0.2, 0.2, 0.4, 0.4, 0.4, 0.3, 0.2, 0.2, 0.3, 0.3, 0.3, 0.3, 0.5, 0.5, 0.4, 0.7, 0.6,
                                                     0.7, 0.6, 0.7, 0.6, 0.5, 0.3, 0.4, 0.7, 0.9, 0.7, 0.8, 1.0, 1.1, 0.9, 0.8};
    float wdir_Cardinal[test_1_min_input_num_pts] = {256.700012, 272.799988, 252.5, 256.200012, 250.699997, 255.399994, 246.399994, 250.699997, 246.399994, 236.899994,
                                                     223.800003, 219.100006, 216.5, 229.600006, 210.100006, 200.5, 210.100006, 201.5, 253.5, 255.399994, 270.0, 264.799988,
                                                     274.0, 289.200012, 317.0, 336.200012, 349.200012, 324.200012, 301.299988, 285.299988, 287.700012, 271.700012, 265.899994,
                                                     255.100006, 261.700012, 195.899994, 116.699997, 142.399994, 107.400002, 157.399994, 171.399994, 164.800003, 167.0, 176.5,
                                                     197.199997, 189.300003, 194.800003, 184.800003, 184.0, 178.199997, 222.300003, 264.5, 277.399994, 286.600006, 275.700012,
                                                     286.100006, 276.5, 272.799988, 274.0, 265.700012};
    initAnemometer();
    for (int i = 0; i < num_pts; i++)
    {
        pushWindSampleCardinal(wdir_Cardinal[i], windSpeedData[i]);
    }
    float windSpeed_vector_avg, windDir_vector_avg;
    getWindVectorMean(&windSpeed_vector_avg,
                      &windDir_vector_avg);
    TEST_ASSERT_EQUAL_FLOAT(24.869240324929873, windDir_vector_avg);
}
